<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario de Equipos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">


  <style>
    body {
      background: linear-gradient(to right, #ece9e6, #ffffff);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: -260px;
      width: 260px;
      height: 100%;
      background: #2c3e50;
      overflow-y: auto;
      transition: left 0.3s ease;
      z-index: 2000;
      padding-top: 60px;
    }
    .sidebar.active {
      left: 0;
    }
    .sidebar a {
      display: block;
      padding: 12px 20px;
      color: #fff;
      text-decoration: none;
      transition: background 0.3s;
    }
    .sidebar a:hover,
    .sidebar a.active {
      background: #34495e;
    }

    /* Bot√≥n hamburguesa */
    #menuBtn {
      position: fixed;
      top: 15px;
      left: 15px;
      font-size: 24px;
      background: #2c3e50;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 8px 12px;
      z-index: 2100;
      cursor: pointer;
    }

    /* Overlay */
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1500;
      display: none;
    }
    #overlay.active {
      display: block;
    }

    /* Contenido */
    .content {
      margin: 20px;
      transition: filter 0.3s;
    }
    .sidebar.active ~ .content {
      filter: blur(2px);
    }

    /* Card personalizadas */
    .card-custom {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsivo */
    @media (max-width: 768px) {
      .sidebar {
        width: 220px;
      }
      #menuBtn {
        font-size: 20px;
        padding: 6px 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Bot√≥n hamburguesa -->
  <button id="menuBtn">‚ò∞</button>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <a href="#" class="active" onclick="mostrarSeccion('equipo', this)">Equipo</a>
    <a href="#" onclick="mostrarSeccion('almacenamiento', this)">Almacenamiento</a>
    <a href="#" onclick="mostrarSeccion('ubicacion', this)">Ubicaci√≥n</a>
    <a href="#" onclick="mostrarSeccion('board', this)">Board</a>
    <a href="#" onclick="mostrarSeccion('grafica', this)">Gr√°fica</a>
    <a href="#" onclick="mostrarSeccion('licencias', this)">Licencias</a>
    <a href="#" onclick="mostrarSeccion('mantenimientos', this)">Mantenimientos</a>
    <a href="#" onclick="mostrarSeccion('pantalla', this)">Pantalla</a>
    <a href="#" onclick="mostrarSeccion('perisfericos', this)">Perif√©ricos</a>
    <a href="#" onclick="mostrarSeccion('ram', this)">Memoria RAM</a>
    <a href="#" onclick="mostrarSeccion('procesador', this)">Procesador</a>
    <a href="#" onclick="mostrarSeccion('so', this)">Sistema Operativo</a>
    <a href="#" onclick="mostrarSeccion('tecnicos', this)">T√©cnicos</a>
    <a href="#" onclick="mostrarSeccion('usuarios', this)">Usuarios</a>
    <a href="#" onclick="mostrarSeccion('usuariodominio', this)">Usuario Dominio</a>
  </div>

  <!-- Overlay -->
  <div id="overlay"></div>

  <!-- Contenido -->
  <div class="content container-fluid">
    <h1 class="text-center mb-4">Inventario de Equipos</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mt-2">
      {% for category, message in messages %}
        <div class="alert alert-{{ 'warning' if category == 'warning' else ('danger' if category == 'danger' else ('success' if category == 'success' else 'info')) }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

    <p>Bienvenido, <strong>{{ usuario }}</strong> ‚Äî Rol: <strong>{{ rol }}</strong></p>

    <!-- Secciones -->
    <div id="equipo" class="seccion card-custom">
      <h3>Equipo</h3>
      <p>Hola, ingresaste a <strong>Equipo</strong>.</p>
    </div>

<div id="almacenamiento" class="seccion card-custom d-none">
  <h3 class="mb-4 text-center fw-bold">
  <i class="bi bi-device-hdd-fill"></i> Almacenamiento
</h3>

  <!-- Botones superiores -->
  <div class="d-flex flex-wrap gap-2 mb-3">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalNuevaCarac">
      ‚ûï Nueva Caracter√≠stica
    </button>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNuevoAlm">
      ‚ûï Nuevo Almacenamiento
    </button>
    <button class="btn btn-warning" data-bs-toggle="collapse" data-bs-target="#bajasTable">
      üìâ Ver Bajas
    </button>
  </div>

  <!-- Tabla principal -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>ID Carac</th>
          <th>Equipo</th>
          <th>Marca</th>
          <th>Horas Uso</th>
          <th>Estado</th>
          <th>Baja</th>
          <th>Capacidad</th>
          <th>Tipo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for r in registros %}
        <tr>
          <td>{{ r[0] }}</td>
          <td>{{ r[1] }}</td>
          <td>{{ r[2] }}</td>
          <td>{{ r[3] }}</td>
          <td>{{ r[4] }}</td>
          <td>
            <span class="badge 
              {% if r[5] == 'Bueno' %} bg-success 
              {% elif r[5] == 'Regular' %} bg-warning text-dark 
              {% else %} bg-danger {% endif %}">
              {{ r[5] }}
            </span>
          </td>
          <td>{{ r[6] }}</td>
          <td>{{ r[7] }}</td>
          <td>{{ r[8] }}</td>
          <td class="d-flex gap-1">
            
            <!-- Bot√≥n Baja -->
            <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalBaja{{ r[0] }}">
              ‚ùå
            </button>

            <!-- Modal Baja -->
            <div class="modal fade" id="modalBaja{{ r[0] }}" tabindex="-1">
              <div class="modal-dialog">
                <div class="modal-content">
                  <form action="{{ url_for('invequip.baja_almacenamiento', id=r[0]) }}" method="post">
                    <div class="modal-header bg-danger text-white">
                      <h5 class="modal-title">Dar de baja ID {{ r[0] }}</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <label class="form-label">Motivo:</label>
                      <input type="text" name="descripcion" class="form-control mb-2" required>
                      <label class="form-label">Fecha Baja:</label>
                      <input type="date" name="fecha_baja" class="form-control" required>
                    </div>
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-danger">Confirmar</button>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Bot√≥n Actualizar -->
            <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#modalActualizar{{ r[0] }}">
              ‚úèÔ∏è
            </button>

            <!-- Modal Actualizar -->
            <div class="modal fade" id="modalActualizar{{ r[0] }}" tabindex="-1">
              <div class="modal-dialog">
                <div class="modal-content">
                  <form action="{{ url_for('invequip.actualizar_almacenamiento', id=r[0]) }}" method="post">
                    <div class="modal-header bg-info text-white">
                      <h5 class="modal-title">Actualizar ID {{ r[0] }}</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <label class="form-label">Equipo:</label>
                      <select name="id_equipo" class="form-select mb-2">
                        {% for e in equipos %}
                          <option value="{{ e[0] }}" {% if e[0] == r[2] %}selected{% endif %}>
                            ID: {{ e[0]}} - CODIGO: {{ e[1] }}
                          </option>
                        {% endfor %}
                      </select>

                      <label class="form-label">Marca:</label>
                      <input type="text" name="marca" value="{{ r[3] }}" class="form-control mb-2">

                      <label class="form-label">Horas Uso:</label>
                      <input type="number" name="horas_uso" value="{{ r[4] }}" class="form-control mb-2">

                      <label class="form-label">Estado:</label>
                      <select name="estado" class="form-select">
                        <option value="Bueno" {% if r[5] == 'Bueno' %}selected{% endif %}>Bueno</option>
                        <option value="Regular" {% if r[5] == 'Regular' %}selected{% endif %}>Regular</option>
                        <option value="Malo" {% if r[5] == 'Malo' %}selected{% endif %}>Malo</option>
                      </select>
                    </div>
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-info">Actualizar</button>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Tabla de bajas -->
  <div class="collapse mt-4" id="bajasTable">
    <h4 class="fw-bold">üìâ Registros en Baja</h4>
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-secondary">
          <tr>
            <th>ID</th>
            <th>ID Registro</th>
            <th>Tabla</th>
            <th>Descripci√≥n</th>
            <th>Fecha Baja</th>
            <th>Fecha Registro</th>
            <th>Acci√≥n</th>
          </tr>
        </thead>
        <tbody>
          {% for b in bajas %}
          <tr>
            <td>{{ b[0] }}</td>
            <td>{{ b[1] }}</td>
            <td>{{ b[2] }}</td>
            <td>{{ b[3] }}</td>
            <td>{{ b[4] }}</td>
            <td>{{ b[5] }}</td>
            <td>
              <form action="{{ url_for('invequip.revertir_baja_almacenamiento', id=b[1]) }}" method="post">
                <button type="submit" class="btn btn-success btn-sm">üîÑ Revertir</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- Modal Nueva Caracter√≠stica -->
<div class="modal fade" id="modalNuevaCarac" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form action="{{ url_for('invequip.nueva_caracteristica') }}" method="post">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">‚ûï Nueva Caracter√≠stica</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <label class="form-label">Capacidad (GB):</label>
          <input type="number" name="capacidad" class="form-control mb-3" required>

          <label class="form-label">Tipo:</label>
          <input type="text" name="tipo" class="form-control mb-3" placeholder="Ej: SSD, HDD" required>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Guardar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Nuevo Almacenamiento -->
<div class="modal fade" id="modalNuevoAlm" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form action="{{ url_for('invequip.nuevo_almacenamiento') }}" method="post">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">‚ûï Nuevo Almacenamiento</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">

          <label class="form-label">Caracter√≠stica:</label>
          <select name="id_carac" class="form-select mb-3" required>
            {% for c in caracteristicas %}
              <option value="{{ c[0] }}">{{ c[1] }} GB - {{ c[2] }}</option>
            {% endfor %}
          </select>

          <!-- ID Equipo oculto (null) -->
          <input type="hidden" name="id_equipo" value="">

          <label class="form-label">Marca:</label>
          <input type="text" name="marca" class="form-control mb-3" required>

          <label class="form-label">Horas Uso:</label>
          <input type="number" name="horas_uso" class="form-control mb-3">

          <label class="form-label">Estado:</label>
          <select name="estado" class="form-select mb-3" required>
            <option value="Bueno">Bueno</option>
            <option value="Regular">Regular</option>
            <option value="Malo">Malo</option>
          </select>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Guardar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>
    <div id="ubicacion" class="seccion card-custom d-none">
      <h3>Ubicaci√≥n</h3>
      <p>Hola, ingresaste a <strong>Ubicaci√≥n</strong>.</p>
    </div>

    <div id="board" class="seccion card-custom d-none">
      <h3>Board</h3>
      <p>Hola, ingresaste a <strong>Board</strong>.</p>
    </div>

    <div id="grafica" class="seccion card-custom d-none">
      <h3>Gr√°fica</h3>
      <p>Hola, ingresaste a <strong>Gr√°fica</strong>.</p>
    </div>

    <div id="licencias" class="seccion card-custom d-none">
      <h3>Licencias</h3>
      <p>Hola, ingresaste a <strong>Licencias</strong>.</p>
    </div>

    <div id="mantenimientos" class="seccion card-custom d-none">
      <h3>Mantenimientos</h3>
      <p>Hola, ingresaste a <strong>Mantenimientos</strong>.</p>
    </div>

    <div id="pantalla" class="seccion card-custom d-none">
      <h3>Pantalla</h3>
      <p>Hola, ingresaste a <strong>Pantalla</strong>.</p>
    </div>

    <div id="perisfericos" class="seccion card-custom d-none">
      <h3>Perif√©ricos</h3>
      <p>Hola, ingresaste a <strong>Perif√©ricos</strong>.</p>
    </div>

    <div id="ram" class="seccion card-custom d-none">
      <h3>Memoria RAM</h3>
      <p>Hola, ingresaste a <strong>Memoria RAM</strong>.</p>
    </div>

    <div id="procesador" class="seccion card-custom d-none">
      <h3>Procesador</h3>
      <p>Hola, ingresaste a <strong>Procesador</strong>.</p>
    </div>

    <div id="so" class="seccion card-custom d-none">
      <h3>Sistema Operativo</h3>
      <p>Hola, ingresaste a <strong>Sistema Operativo</strong>.</p>
    </div>

    <div id="tecnicos" class="seccion card-custom d-none">
      <h3>T√©cnicos</h3>
      <p>Hola, ingresaste a <strong>T√©cnicos</strong>.</p>
    </div>

    <div id="usuarios" class="seccion card-custom d-none">
      <h3>Usuarios</h3>
      <p>Hola, ingresaste a <strong>Usuarios</strong>.</p>
    </div>

    <div id="usuariodominio" class="seccion card-custom d-none">
      <h3>Usuario Dominio</h3>
      <p>Hola, ingresaste a <strong>Usuario Dominio</strong>.</p>
    </div>

    <a href="{{ url_for('home') }}" class="btn btn-secondary mt-3">‚¨Ö Volver al Home</a>
  </div>

  <script>
    const menuBtn = document.getElementById("menuBtn");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");

    // Toggle sidebar
    menuBtn.addEventListener("click", () => {
      sidebar.classList.toggle("active");
      overlay.classList.toggle("active");
    });

    // Cerrar con overlay
    overlay.addEventListener("click", () => {
      sidebar.classList.remove("active");
      overlay.classList.remove("active");
    });

    // Mostrar secci√≥n
    function mostrarSeccion(id, link) {
      // Ocultar todas
      document.querySelectorAll('.seccion').forEach(sec => sec.classList.add('d-none'));
      // Mostrar la seleccionada
      document.getElementById(id).classList.remove('d-none');
      // Marcar activo en men√∫
      document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
      if (link) {
      link.classList.add('active');
      }else {
        // Si no hay link, buscar el <a> que contiene el id en su onclick
    document.querySelectorAll('.sidebar a').forEach(a => {
      if (a.getAttribute("onclick")?.includes(id)) {
        a.classList.add('active');
      }
    });
  }
      // Cerrar
      //  sidebar en m√≥vil
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  window.addEventListener("DOMContentLoaded", function () {
    const params = new URLSearchParams(window.location.search);
    const seccion = params.get("seccion");
    if (seccion) {
      mostrarSeccion(seccion);
      // Opcional: marcar el bot√≥n activo
      document.querySelectorAll(".sidebar a").forEach(a => {
        a.classList.remove("active");
        if (a.getAttribute("onclick")?.includes(seccion)) {
          a.classList.add("active");
        }
      });
    }
  });
</script>
<script>
  // Cerrar alertas autom√°ticamente en 5 segundos
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(alert => {
      const bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    });
  }, 5000);
</script>


</body>
</html>
